<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì ì‹¬ ë­ ë¨¹ì§€?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#121a33;
      --card:rgba(255,255,255,0.08);
      --card2:rgba(255,255,255,0.06);
      --text:#eef2ff;
      --muted:rgba(238,242,255,0.7);
      --line:rgba(255,255,255,0.14);
      --shadow: 0 20px 60px rgba(0,0,0,0.45);
      --radius: 22px;
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 500px at 20% 15%, rgba(124,58,237,0.55), transparent 55%),
        radial-gradient(800px 500px at 85% 25%, rgba(59,130,246,0.55), transparent 60%),
        radial-gradient(700px 450px at 50% 95%, rgba(16,185,129,0.35), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    /* subtle noise */
    body:before{
      content:"";
      position:fixed;
      inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      opacity:.10;
      pointer-events:none;
      mix-blend-mode:overlay;
    }

    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 28px 16px;
    }

    .shell{
      width:100%;
      max-width: 480px;
      position:relative;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,0.06);
      border-radius:999px;
      font-size:13px;
      color:var(--muted);
      backdrop-filter: blur(10px);
      margin-bottom: 14px;
    }

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px 22px 18px;
      backdrop-filter: blur(14px);
      position:relative;
      overflow:hidden;
    }

    .card:after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 220px at 20% 0%, rgba(255,255,255,0.14), transparent 60%);
      pointer-events:none;
    }

    h1{
      margin: 6px 0 6px;
      font-size: 26px;
      letter-spacing: -0.6px;
    }

    .sub{
      margin:0 0 18px;
      color:var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .actions{
      display:flex;
      flex-direction:column;
      gap: 10px;
      margin-top: 10px;
    }

    .btn{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px 14px;
      cursor:pointer;
      font-weight: 650;
      font-size: 15px;
      letter-spacing: -0.2px;
      transition: transform .08s ease, filter .15s ease, background .2s ease, border-color .2s ease;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      user-select:none;
    }

    .btn:active{ transform: translateY(1px) scale(0.998); }

    .primary{
      background: linear-gradient(135deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
    }
    .primary:hover{ filter: brightness(1.08); border-color: rgba(255,255,255,0.26); }

    .secondary{
      background: rgba(255,255,255,0.05);
    }
    .secondary:hover{ filter: brightness(1.05); border-color: rgba(255,255,255,0.22); }

    .btn .left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }

    .icon{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      flex: 0 0 auto;
    }

    .label{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:2px;
      min-width:0;
    }

    .label strong{
      font-size: 15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .label span{
      font-size: 12.5px;
      color: var(--muted);
      font-weight: 500;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .chev{
      color: rgba(238,242,255,0.75);
      font-weight: 900;
      flex: 0 0 auto;
    }

    .result{
      margin-top: 18px;
      border-top: 1px dashed rgba(255,255,255,0.18);
      padding-top: 18px;
      min-height: 72px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }

    .result .empty{
      color: rgba(238,242,255,0.55);
      font-size: 13.5px;
    }

    .pick{
      animation: pop .22s ease-out;
      line-height: 1.35;
    }

    .pick .top{
      color: rgba(238,242,255,0.75);
      font-size: 13.5px;
      margin-bottom: 6px;
    }

    .pick .menu{
      font-size: 22px;
      font-weight: 800;
      letter-spacing: -0.6px;
    }

    .tiny{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      color: rgba(238,242,255,0.55);
      font-size: 12px;
    }

    .link{
      color: rgba(238,242,255,0.65);
      text-decoration:none;
      border-bottom: 1px dotted rgba(238,242,255,0.25);
    }
    .link:hover{ color: rgba(238,242,255,0.9); }

    .toast{
      position:absolute;
      left: 50%;
      bottom: -10px;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(255,255,255,0.14);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      color: rgba(238,242,255,0.88);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      white-space:nowrap;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-10px);
    }

    @keyframes pop{
      from{ transform: translateY(6px); opacity: 0; }
      to{ transform: translateY(0); opacity: 1; }
    }

    .loading{
      opacity:.65;
      pointer-events:none;
    }

    @media (max-width: 420px){
      .card{ padding: 22px 18px 16px; }
      h1{ font-size: 24px; }
      .pick .menu{ font-size: 20px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="badge">ğŸ½ï¸ Lunch Picker ì  Â· ë©” Â· ì¶” </div>

      <div class="card">
        <h1>ì˜¤ëŠ˜ ì ì‹¬ ë­ ë¨¹ì§€?</h1>
        <p class="sub">ê³ ë¯¼ì€ ì—¬ê¸°ê¹Œì§€ë§Œ. ë²„íŠ¼ í•œ ë²ˆì´ë©´ ë.</p>

        <div class="actions">
          <button class="btn primary" id="btnRandom" onclick="pickRandom()">
            <div class="left">
              <div class="icon">âš¡</div>
              <div class="label">
                <strong>ê·¸ëƒ¥ ê³¨ë¼ì¤˜</strong>
                <span>ë¹ ë¥´ê²Œ í•˜ë‚˜ë§Œ ì¶”ì²œ</span>
              </div>
            </div>
            <div class="chev">â€º</div>
          </button>

          <button class="btn secondary" id="btnSpin" onclick="spinRoulette()">
            <div class="left">
              <div class="icon">ğŸ¡</div>
              <div class="label">
                <strong>ë£°ë ›ìœ¼ë¡œ ê³ ë¥´ê¸°</strong>
                <span>ì¬ë°Œê²Œ ëŒë ¤ì„œ ê²°ì •</span>
              </div>
            </div>
            <div class="chev">â€º</div>
          </button>
        </div>

        <div class="result" id="result">
          <div class="empty">ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê³¨ë¼ë³´ì„¸ìš”.</div>
        </div>

        <div class="tiny">
          <span>Â© 2026 ì  Â· ë©” Â· ì¶”</span>
          <a class="link" href="/docs" target="_blank" rel="noreferrer">ê°œë°œììš©</a>
        </div>

        <div class="toast" id="toast">ì ê¹ë§Œìš”â€¦</div>
      </div>
    </div>
  </div>

  <script>
    const resultEl = document.getElementById("result");
    const toastEl = document.getElementById("toast");
    const btnRandom = document.getElementById("btnRandom");
    const btnSpin = document.getElementById("btnSpin");

    function setLoading(isLoading) {
      [btnRandom, btnSpin].forEach(b => b.classList.toggle("loading", isLoading));
      if (isLoading) showToast("ì ê¹ë§Œìš”â€¦");
      else hideToast();
    }

    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
    }
    function hideToast(){
      toastEl.classList.remove("show");
    }

    function showPick(menu){
      resultEl.innerHTML = `
        <div class="pick">
          <div class="top">ì˜¤ëŠ˜ì˜ ì ì‹¬ì€</div>
          <div class="menu">ğŸ½ï¸ ${escapeHtml(menu)}</div>
        </div>
      `;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    async function pickRandom() {
      try{
        setLoading(true);
        const res = await fetch("/api/random");
        if(!res.ok) throw new Error("API ì˜¤ë¥˜");
        const data = await res.json();
        showPick(data.menu);
      } catch(e){
        showToast("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      } finally{
        setLoading(false);
      }
    }

    async function spinRoulette() {
      try {
        setLoading(true);
        
        const res = await fetch("/api/spin?ticks=22");
        if (!res.ok) throw new Error("API ì˜¤ë¥˜");
        const data = await res.json();
        
        const ticks = data.ticks || [];
        if (ticks.length === 0) {
            showPick(data.result);
            return;
        }

      let i = 0;
      const timer = setInterval(() => {
        showPick(ticks[i] ?? data.result);
        i++;

        if (i >= ticks.length) {
          clearInterval(timer);
          showPick(data.result);
          showToast("ë£°ë › ì™„ë£Œ!");
          setLoading(false);
        }
      }, 80);

    } catch (e) {
      showToast("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      setLoading(false);
    }
  }

  </script>
</body>
</html>
